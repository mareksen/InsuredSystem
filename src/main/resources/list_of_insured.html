<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>List of Insured - Insurance System</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">

    <style>
        .table td {
        white-space: nowrap;
        }

        .date-of-birth-cell {
        white-space: nowrap;
        }

    </style>

</head>
<body>

<!-- Navigation Bar -->
<nav class="navbar navbar-expand-lg navbar-light bg-light">
    <a class="navbar-brand" href="home.html">Insurance System</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
            aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav">
            <li class="nav-item">
                <a class="nav-link" href="list_of_insured.html">List of Insured</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="list_of_policies.html">List of Insurance Policies</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="add_insured.html">Add Insured</a>
            </li>
        </ul>
    </div>
</nav>

<!-- Page Content for List of Insured -->
<div class="container mt-4">
    <h1>List of Insured</h1>
    <table class="table">
        <thead>
        <tr>
            <th>ID</th>
            <th>First Name</th>
            <th>Last Name</th>
            <th>Email</th>
            <th>Phone</th>
            <th>Permanent Residence</th>
            <th>Date of Birth</th>
            <th>Social Security Number</th>
            <th>Place of Birth</th>
            <th>Marital Status</th>
            <th>Actions</th>
        </tr>
        </thead>
        <tbody id="insuredList">
        <!-- Items will be inserted dynamically using JavaScript -->
        </tbody>
    </table>
</div>

<!-- Bootstrap Scripts -->
<script>
    // Function to load the list of insured individuals from the server
    function loadInsuredList() {
        // Fetches data from the server
        fetch('http://localhost:8080/api/insured')
        .then(response => response.json()) // Parses the response as JSON
        .then(data => {
            // Accesses the table body element where the list will be displayed
            const tableBody = document.getElementById('insuredList');
            // Iterates over each insured individual in the fetched data
            data.forEach(insured => {
                // Creates a table row for each insured individual
                const tr = document.createElement('tr');
                // Sets the inner HTML of the row with insured individual's data
                tr.innerHTML = `
                    <td>${insured.id}</td>
                    <td>${insured.firstName}</td>
                    <td>${insured.lastName}</td>
                    <td>${insured.email}</td>
                    <td>${insured.phone}</td>
                    <td>${insured.residence}</td>
                    <td>${new Date(insured.dateOfBirth).toLocaleDateString()}</td>
                    <td>${insured.socialSecurityNumber}</td>
                    <td>${insured.placeOfBirth}</td>
                    <td>${insured.maritalStatus}</td>
                    <td>
                        <button onclick="goToInsuredDetail(${insured.id})">View Details</button>
                    </td>
                `;
                // Appends the created row to the table body
                tableBody.appendChild(tr);
            });
        })
        .catch((error) => console.error('Error:', error)); // Error handling
    }

    // Function to navigate to the insured individual's detail page
    function goToInsuredDetail(insuredId) {
        // Redirects the browser to the insured detail page with the insured ID in the query string
        window.location.href = `insured_detail.html?insuredId=${insuredId}`;
    }

    // Calls the loadInsuredList function when the window is loaded
    window.onload = loadInsuredList;
</script>

<!-- jQuery and Bootstrap JS for additional functionality -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.9.2/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</body>
</html>


